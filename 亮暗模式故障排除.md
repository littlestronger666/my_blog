# 亮/暗模式故障排除指南

## 已实施的修复

### 1. 更新了 Tailwind 配置
**tailwind.config.js**:
```javascript
module.exports = {
  darkMode: ['class'],
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
  ],
}
```

### 2. 更新了 CSS 配置
**app/globals.css**:
```css
@import "tailwindcss";

/* Light mode colors */
@theme {
  --color-background: #ffffff;
  --color-foreground: #171717;
}

/* Dark mode colors - using .dark class */
.dark {
  @theme {
    --color-background: #0a0a0a;
    --color-foreground: #ededed;
  }
}
```

### 3. 改进了 ThemeSwitcher 组件
- 使用 `resolvedTheme` 来正确处理 system 主题
- 添加了加载状态的占位符
- 改进了图标的暗色模式显示

## 测试步骤

### 1. 启动开发服务器
```bash
npm run dev
```

### 2. 打开浏览器开发者工具
按 F12 打开开发者工具，切换到 Console 标签。

### 3. 检查 HTML 元素
在 Elements 标签中，检查 `<html>` 标签：
- 点击主题切换按钮
- 观察 `<html>` 标签是否添加/移除 `class="dark"` 属性

### 4. 检查 localStorage
在 Console 中输入：
```javascript
localStorage.getItem('theme')
```
应该返回 `"light"` 或 `"dark"`。

### 5. 测试主题切换
1. 点击右上角的主题切换按钮
2. 观察页面颜色变化：
   - **亮模式**: 白色背景，深色文字
   - **暗模式**: 深色背景，浅色文字
3. 刷新页面，确认主题保持不变

## 常见问题

### Q1: 点击按钮没有反应
**解决方案**:
1. 检查浏览器控制台是否有 JavaScript 错误
2. 确认 `next-themes` 已正确安装：
   ```bash
   npm list next-themes
   ```
3. 清除浏览器缓存并硬刷新（Ctrl+Shift+R）

### Q2: 主题切换了但样式没变
**解决方案**:
1. 检查组件是否使用了 `dark:` 前缀的类名
2. 确认 Tailwind 配置中有 `darkMode: ['class']`
3. 重新构建项目：
   ```bash
   npm run build
   npm run dev
   ```

### Q3: 刷新后主题丢失
**解决方案**:
1. 检查 `ThemeProvider` 的配置
2. 确认浏览器允许 localStorage
3. 在控制台检查：
   ```javascript
   localStorage.getItem('theme')
   ```

### Q4: 系统主题不生效
**解决方案**:
1. 确认 `ThemeProvider` 有 `enableSystem` 属性
2. 检查 CSS 中的 `@media (prefers-color-scheme: dark)` 规则
3. 在浏览器设置中更改系统主题测试

## 调试技巧

### 1. 手动切换主题
在浏览器控制台输入：
```javascript
// 切换到暗模式
document.documentElement.classList.add('dark')

// 切换到亮模式
document.documentElement.classList.remove('dark')
```

### 2. 检查 Tailwind 类是否生效
在控制台输入：
```javascript
// 检查某个元素的计算样式
const el = document.querySelector('.dark\\:bg-gray-900')
window.getComputedStyle(el).backgroundColor
```

### 3. 监听主题变化
```javascript
// 监听 localStorage 变化
window.addEventListener('storage', (e) => {
  if (e.key === 'theme') {
    console.log('Theme changed to:', e.newValue)
  }
})
```

## 验证清单

运行以下检查确保一切正常：

- [ ] `npm run build` 成功无错误
- [ ] 开发服务器启动正常
- [ ] 页面加载时显示正确的主题
- [ ] 点击主题切换按钮，页面颜色立即改变
- [ ] `<html>` 标签的 class 正确切换
- [ ] localStorage 中保存了主题设置
- [ ] 刷新页面后主题保持不变
- [ ] 所有页面的主题一致
- [ ] 浏览器控制台没有错误

## 如果还是不工作

### 完全重置
```bash
# 1. 停止开发服务器

# 2. 删除缓存
rm -rf .next
rm -rf node_modules/.cache

# 3. 清除浏览器数据
# 在浏览器控制台输入：
localStorage.clear()
sessionStorage.clear()

# 4. 重新构建
npm run build

# 5. 启动开发服务器
npm run dev
```

### 检查依赖版本
```bash
npm list next-themes tailwindcss
```

确保版本兼容：
- `next-themes`: ^0.4.x
- `tailwindcss`: ^4.x

## 预期行为

### 亮模式
- 背景: 白色 (#ffffff)
- 文字: 深灰色 (#171717)
- 卡片: 浅灰色 (gray-50)
- 按钮图标: 月亮（深色）

### 暗模式
- 背景: 深黑色 (#0a0a0a)
- 文字: 浅灰色 (#ededed)
- 卡片: 深灰色 (gray-800)
- 按钮图标: 太阳（黄色）

## 技术支持

如果问题仍然存在：
1. 检查 `TAILWIND_V4_说明.md` 了解 Tailwind v4 的特殊配置
2. 查看浏览器控制台的详细错误信息
3. 确认所有依赖都已正确安装
